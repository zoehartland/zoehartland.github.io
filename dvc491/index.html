<!DOCTYPE html>
<html lang="en">

<head>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,600' rel='stylesheet' type='text/css'>
    <title>CPIH by household group</title>

    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no" />
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
	
    <link rel="stylesheet"  href="lib/ONSstyle.css" />
	<link rel="stylesheet" href="lib/styles.css" />
	<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet" />
	
    <style type="text/css">
		body {
			max-width: 944px;
			margin: 0px auto;
		}
	/*	.row{
			border:1px solid grey;
			box-sizing: border-box;
			-moz-box-sizing: border-box;
			-webkit-box-sizing: border-box;
		}
		
		.col-lg-3, .col-md-3, .col-sm-3, .col-xs-3{
			border:1px solid red;
			box-sizing: border-box;
			-moz-box-sizing: border-box;
			-webkit-box-sizing: border-box;
		}
		
		.btn{
			margin-top:5px!important;
		}*/
		
/*		h5{
			margin-top:20px;
		}*/
		
		.input-group {
			width:125px;
			margin-left: auto;
			margin-right: auto;	
			padding-top:0px;
		}
		
		label {
			font-size: 16px;
			font-weight: normal;
		}
		
		.form-group{
			display: block;
			text-align:center;
			margin-left: auto;
			margin-right: auto;	
		}
		.form-control {
			height: 22px;
			font-size: 16px;
		}
		
		.form-inline .form-control {
			display: inline-block;
			width: auto;
			vertical-align: middle;
			
		}
		
		.form-inline .input-group {
			display: inline-table;
			vertical-align: middle;
		}
		
		#adultPic {
			height: 62px;
			top: 50px;
		}
		
		#adultPic2 {
			width:100%;	
			text-align:center;
			margin-bottom:10px;

		}
		
		#adultPic2 img{
			display:inline-block;
			/*padding-bottom: 10px;*/
			margin-left: auto;
			margin-right: auto;	
			margin-bottom:10px;
			margin-top: 15px;
		}
		
		
	
		.btn-plus, .btn-minus {
			background-color:#3CB0F9;
			border:-1px;
			border-color:#3CB0F9;
			color:#fff;
		}
		
		.btn-plus:hover, .btn-minus:hover, .btn-plus:disabled, .btn-minus:disabled, .btn-plus:active, .btn-minus:active, .btn-plus:focus, .btn-minus:focus {
			background-color:#3CB0F9;
			border:-1px;
			border-color:#3CB0F9;
			opacity:0.5;
			color:#fff;
		}
		
		#adults, #child {
			text-align: center;
		}
		
		#submit{
			margin-top:15px;
			margin-bottom:15px;
			display:inline-block;
		}
	
		.pound{
			font-weight: 900;
			font-size: 20px;
			padding: 8px 14px;
		}
		
		.has-error{
			border: 1px solid red;
		}
		
		.measure_caption {
			height: 30px;
		}

		.value{
			font-size: 15px;
			font-weight: 900;
			fill: #3CB0F9;
            stroke: none!important;
		}
		
	/* Popup container - can be anything you want */
	.popup {
		position: relative;
		display: inline-block;
		cursor: pointer;
		-webkit-user-select: none;
		-moz-user-select: none;
		-ms-user-select: none;
		user-select: none; 
		pointer-events: none;
	}

	/* The actual popup */
	.popup .popuptext {
		visibility: hidden;
		width: 370px;
		background-color: #555;
		color: #fff;
		text-align: center;
		border-radius: 6px;
		padding: 3px;
		position: absolute;
		z-index: 10;
		bottom: 1%;
		left: 50%;
		margin-left: -185px;
	}
		
	/* Toggle this class - hide and show the popup */
	.popup .show {
		visibility: visible;
		-webkit-animation: fadeIn 1s;
		animation: fadeIn 1s;
	}

	/* Add animation (fade in the popup) */
	@-webkit-keyframes fadeIn {
		from {opacity: 0;} 
		to {opacity: 1;}
	}

	@keyframes fadeIn {
		from {opacity: 0;}
		to {opacity:1 ;}
	}
		
	.decile{
		font-size: 30px;
		font-weight: 900;
		color: #3CB0F9;
		fill: #3CB0F9;
	}

	.tspans{
		font-size: 20px;
		font-weight: 900;
		color: #3CB0F9;
		fill: #3CB0F9;
	}	
		
	.select2{
		width:120px!important;
	}
	
	.comparison div{
		display: inline-grid;
	}
		
	.domain{
		stroke:none!important;
	}
		
	@media only screen and (max-width: 630px) {
   		.anno{
			font-size:11px;
		}
	}
		
		#keypoints_dots, #keypoints_dots2{
			font-size:12px;
			line-height: 15px;
		}

		.reveal{
			margin-bottom: 30px;
			font-weight:700;
			font-size:16px;
		}
		input#hhincome {
			width: 90px;
		}
		#incPeriod{
			height:41px;
		}
		
		#graphic .key {
            margin: 0 0 1em 0;
            padding: 0;
            list-style-type: none;
        }

        #graphic .key li {
            display: inline-block;
            margin: 0 18px 0 0;
            padding: 0;
            line-height: 15px;
        }

        #graphic .key  b {
            display: inline-block;
            width: 15px;
            height: 15px;
            margin-right: 6px;
            float: left;
			background-color:red;
			border-radius:15px;
			opacity: 0.8
        }

        #graphic .key label {
            white-space: nowrap;
        }
		
		#graphic .unit {
           text-align: left;
        }
	</style>

</head>
<script src="https://cdn.ons.gov.uk/vendor/jquery/2.1.4/jquery.min.js" type="text/javascript"></script>
<script src="https://cdn.ons.gov.uk/vendor/d3/4.2.7/d3.js" type="text/javascript"></script>
<script src="./lib/modernizr.svg.min.js" type="text/javascript"></script>
<script src="https://cdn.ons.gov.uk/vendor/pym/1.3.2/pym.min.js" type="text/javascript"></script>
<script src="./lib/swoopy-drag-d3v4.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/js/select2.min.js"></script>
<script src="lib/d3v4jetpack.js" type="text/javascript"></script>
	
<body>
	
	<div class="wrapper">
		<div class="dashboard">
			<div id="graphic" >
				
				<div class="decile_exp "></div>
				<div class="col-sm-offset-1  reveal hidden-xs">
					Click here to find where your household fits into the distribution.
                    <button id="reveal" type="button" class=" btn btn--neutral btn--bold btn--large btnnext">How do you fit in?</button>
							
				</div>
                <div id="inputs" class="hide hidden-xs">
					<div class="row">
							<div id="adultfor" class="form-group col-sm-8 col-xs-12">

							<label for="adults"><h5>How many people live in your household?</h5></label>
								<div class="input-group">
									<span class="input-group-btn">
										<button type="button" class="btn btn-minus btn-number minus"  data-type="minus" data-field="quant[2]">
										  <span class="glyphicon glyphicon-minus"></span>
										</button>
									</span>
									<input type="text" id="adults"name="quant[2]" class="form-control input-number" value="1" min="1" max="100">
									<span class="input-group-btn">
										<button type="button" class="btn btn-plus btn-number plus" data-type="plus" data-field="quant[2]">
											<span class="glyphicon glyphicon-plus"></span>
										</button>
									</span>
								</div>
							</div>

							<div id="adultPic" class="hidden-xs col-sm-4 col-xs-12"></div>	


							<div id="childfor" class="form-group col-sm-8 col-xs-12">

								<label for="child"><h5>How many of the people in your household are aged under 15?</h5></label>

								<div class="input-group">

									<span class="input-group-btn">
										<button type="button" class="btn btn-minus btn-number minus"  data-type="minus" data-field="quant[3]">
										  <span class="glyphicon glyphicon-minus"></span>
										</button>
									</span>
									<input type="text" id="child"name="quant[3]" class="form-control input-number" value="0" min="0" max="100">
									<span class="input-group-btn">
										<button type="button" class="btn btn-plus btn-number plus" data-type="plus" data-field="quant[3]">
											<span class="glyphicon glyphicon-plus"></span>
										</button>
									</span>
								</div>
								<div id="adultPic2" class="visible-xs"></div>
							</div>

					</div>
					<div class="row" id="hhincrow">
						  <div class="form-group form-inline col-sm-8 col-xs-12">
							<label for="hhincome"><h5 style="margin-bottom: 0px;">What was your total household income this year?</h5><p>(after income tax and national insurance) <img id="info" src="images/info.png" height="20px" width="20px" onmouseover="showPopUp()" onMouseOut="hidePopUp()"></img></p></label>



							<div class="input-group">
								<div class="input-group-addon pound">£</div>
								<input class="form-control inc" id="hhincome" placeholder="">
							</div>
							<select id="incPeriod" class="form-control">
                                <option value="1">Weekly</option>
                                <option value="2" selected>Monthly</option>
                                <option value="3">Yearly</option>
                            </select>
                            </br>
							<button id="submit" type="submit" class=" btn btn--neutral btn--bold btn--large form-group btnnext">Show me...</button>
							 <button id="refresh" type="button" class="hide btn btn--neutral btn--bold btn--large btnnext">Refresh</button>
                            <div class="popup">
							  <span class="popuptext" id="myPopup">
								<p>Include all income you receive from wages, salaries, pensions, investments and cash benefits.</p>
								<p>Cash benefits are those you receive as money. For example Child Benefit, Jobseeker's Allowance, Disability Living Allowance, State Pension, Tax Credits etc.</p>
							  </span>
							</div>
						  </div>
						  <!--<div class="form-group form-inline col-sm-4 col-xs-12 hidden-xs">
							<p class="helppara" for="hhincome">Include all income you receive from wages, salaries, pensions, investments and cash benefits.</p><p class="helppara">Cash benefits are those you receive as money, they include Child Benefit, Jobseeker's Allowance, Disability Living Allowance, State Pensions, Tax Credits etc.</p>
						</div>-->
                        
                           
                        
					</div>
				</div>
				<div class="container-fluid"> 
					<div class="row">
						<div class="col-xs-12 col-sm-12" id="bar_annotation" >
							<!--Your household has a <tspan class="tspans" id="high_low"></tspan> income than around <tspan class="tspans" id="percent_pop"></tspan> of the population. Households in your income decile <tspan class="tspans" id="your_decile">xx</tspan> had an inflation rate of <tspan class="tspans" id="percent_inflat"> </tspan> in March 2018. 
							<div class="comparison">
								<text class="comparison1"></text>
								<div id="dropdown"></div>
								<text class= "comparison2"></text>
							</div>-->
							<div class="" id="graphic_line">
                            	<img src="fallback_line.png" alt="[Chart]" />
							</div>
							<div id="keypoints_line">
								<p></p>
							</div>
						</div>
						
						<div class="col-xs-12 col-sm-12">
							<!--By March 2018, households similar to yours experienced a price change of <tspan class= "tspans" id="price_change">X</tspan> since 2005, compared with 32% for the average CPIH (which covers all households). On average, your group spends the following proportion of expenditure on…-->
							<div id="keypoints_dots">
								<p></p>
							</div>
							<div id="graphic_dots"><img src="fallback_dot.png" alt="[Chart]" /></div>
							<div id="keypoints_dots2">
								<p></p>
							</div>
						</div>
					</div>
				</div>  
				
				
			</div>
		</div>
	</div>
<script>

var graphic_dots = d3.select('#graphic_dots');
var graphic_line = d3.select('#graphic_line');
var keypoints_line = d3.select('#keypoints_line');
var keypoints_dots = d3.select('#keypoints_dots');
var keypoints_dots2 = d3.select('#keypoints_dots2');
		
var pymChild = null;
var deciles = [0, 13697, 17534, 20486, 23640, 27317, 31666, 36835, 43363, 55391];
			  
function drawTieFighter(){
	var labels = ['Aggregate CPIH', "Decile 2", "Decile 9"]
	var colourArray = ["#aaa", "#ff9933", "#36add9"]
	var threshold_sm =550;
	var threshold_md_dots = 680;
	//console.log(parseInt(graphic_dots.style("width")))
	
	if(parseInt(graphic_dots.style("width"))<threshold_sm){
		//console.log("sm")
		ball = 6;
		var margin = {	top: dvc_dots.optional.margin_sm[0], 
						right: dvc_dots.optional.margin_sm[1], 
						bottom: dvc_dots.optional.margin_sm[2], 
						left: dvc_dots.optional.margin_sm[3]};
		var chart_width = parseInt(graphic_dots.style("width")) - margin.left - margin.right;
		var height = Math.ceil((chart_width * dvc_dots.optional.aspectRatio_sm[1]) / dvc_dots.optional.aspectRatio_sm[0]) - margin.top - margin.bottom;
	
	} else if (parseInt(graphic_dots.style("width"))< threshold_md_dots ){
		//console.log("md")
		ball = 7
		var margin = {	top: dvc_dots.optional.margin_md[0], 
						right: dvc_dots.optional.margin_md[1], 
						bottom: dvc_dots.optional.margin_md[2], 
						left: dvc_dots.optional.margin_md[3]};
		var chart_width = parseInt(graphic_dots.style("width")) - margin.left - margin.right;
		var height = Math.ceil((chart_width * dvc_dots.optional.aspectRatio_md[1]) / dvc_dots.optional.aspectRatio_md[0]) - margin.top - margin.bottom;
	} else {
		//console.log("lg")
		
		ball = 8
		var margin = {	top: dvc_dots.optional.margin_lg[0], 
						right: dvc_dots.optional.margin_lg[1], 
						bottom: dvc_dots.optional.margin_lg[2], 
						left: dvc_dots.optional.margin_lg[3]};
		var chart_width = parseInt(graphic_dots.style("width")) - margin.left - margin.right;
		var height = Math.ceil((chart_width * dvc_dots.optional.aspectRatio_lg[1]) / dvc_dots.optional.aspectRatio_lg[0]) - margin.top - margin.bottom;
		
	}
 	// clear out existing graphics
	graphic_dots.selectAll("*").remove();
	keypoints_dots.selectAll("*").remove();
	keypoints_dots2.selectAll("*").remove();
			
			
	var xDot = d3.scaleLinear()
		.range([ 0, chart_width]);

	var yDot = d3.scalePoint()
	.range([0, height], .3);
		
	yDot.domain(graphic_data_dots.map(function(d) { return d.name; }));

	var yDotAxis = d3.axisLeft(yDot)

	var xDotAxis = d3.axisBottom(xDot);
	xDotAxis.ticks(dvc_dots.optional.x_num_ticks_sm_md_lg[0])
	
	lines = graphic_data_dots.map(function(d,i) { 
				return {
				//	lines.x: csv.column_headings
					'name': d.name,   // might not need since we mapped it in y.domain earlier
					'inflation_by_COICOP' : d.inflation_by_COICOP,
					'decile1': +d.decile1,   // + changes string to numeric.
					'decile2': +d.decile2,
					'decile3': +d.decile3,
					'decile4': +d.decile4,
					'decile5': +d.decile5,
					'decile6': +d.decile6,
					'decile7': +d.decile7,
					'decile8': +d.decile8,
					'decile9': +d.decile9,
					'decile10': +d.decile10,
					'decile11': +d.decile11
					
				};
			});
	
	var xDotDomain = [0, 40]
	
	xDot.domain(xDotDomain);
	
	var legend = d3.select('#graphic_dots').append('ul')
                .attr('class', 'key')
            	.selectAll('g')
                .data(labels)
            	.enter().append('li')
				.attr("id", function(d,i){ return "key"+i })
                .attr('class', function(d, i) {
					if(i==1){
						return "anno"
					}	
				});
       	
		legend.append('b')
			.style("background-color", function(d,i) { return colourArray[i]; })
       
	    legend.append('label')
            .html(function(d,i) { return labels[i]; });
	 
	//create svg for chart
	var svg = d3.select('#graphic_dots').append('svg')
			.attr("id","tie_fighter_chart")
			.style("background-color","#fff")
			.attr("width", chart_width + margin.left + margin.right)
			.attr("height", height + margin.top + margin.bottom)
			.append("g")
			.attr("transform", "translate(" + margin.left + "," + (margin.top) + ")")

	svg.append("rect")
		.attr("class","svgRect")
		.style("fill", "#fff")
		.attr("width", chart_width)
		.attr("height", height);

	svg.append('g')
		.attr('class', 'x axis')
		.attr("transform", "translate(0, "+height+")")
		.call(xDotAxis.tickSize(-height, 0))
		.selectAll("line")
		.style("stroke","#E5E6E7");


	svg.select(".x.axis")
		 .append("text")
		 .attr("y", 35)
		 .attr("x",chart_width)
		 .attr("dy", ".71em")
		 .style("text-anchor", "end")
		 .text("Average % share of expenditure, 2005 to 2018");


	//move the x number down a bit
	d3.select("#graphic_dots").selectAll(".tick").select("text").attr("transform","translate(0,10)")

	//create y axis, if x axis doesn't start at 0 drop x axis accordingly
	svg.append('g')
		.attr('class', 'y axis')
		.attr('transform', 'translate(' + 0  + ', 0)')
		//.call(yDotAxis);

	d3.select(".y.axis").selectAll("line").remove();

	circles = svg.append("g").attr("class", "circles")
	//console.log(graphic_data_dots.columns)

graphic_data_dots.columns.forEach(
		function(decile){
			if (decile == "inflation_by_COICOP"){
//				svg.append("g").attr("class", "inflat_vals")
//					.selectAll("text")
//					.data(lines)
//					.enter()
//					.append('text')
//					.attr("transform", function(d,i){ return "translate("+ (chart_width+20) +","+ (yDot(d.name) +10) +")" })
//					.text(function(d,i){ return d.inflation_by_COICOP})
			
				placement = [24.7, 14.8, 12.6, 11.9, 11.4, 8.9, 5.5, 5.9, 4.5, 2.5, 2.2, 3.3]
				
				svg.append("g").attr("class", "y axis labels")
					.selectAll("text")
					.data(lines)
					.enter()
					.append('text')
					.attr("text-anchor", function(d,i){ 
						if(i==0){
							return "end"
						} else {
							return "start"
						}
					 })
					.attr("transform", function(d,i){
						if(i==0){
							return "translate("+ ( xDot(placement[i]-2))+","+ (yDot(d.name)) +")" 
						} else {
							return "translate("+ ( xDot(placement[i]+2))+","+ (yDot(d.name)) +")" 
						}
					})
					.text(function(d,i){ return d.name})
				
				
				svg.append("g").attr("class", "dotted_lines")
					.selectAll("line")
					.data(lines)
					.enter()
					.append('line')
					.attr("stroke", "#ccc")
					.attr("stroke-dasharray",5)
					.attr("x1", function(d,i){ 
							if(i==0){ 
								return xDot(placement[i]-0.5) 
							} else {
								return xDot(placement[i]+0.5) 
							} 
					})
					.attr("x2", function(d,i){ 
							if(i==0){ 
								return xDot(placement[i]-2) 
							} else {
								return xDot(placement[i]+2) 
							}
					
					})
					.attr("y1", function(d,i){ return yDot(d.name) })
					.attr("y2", function(d,i){ return yDot(d.name) })
					
			} else if(decile != "name" && decile != "inflation_by_COICOP"){
				circles.append("g").attr("class", "circle_"+decile)
					.selectAll("circle")
					.data(lines)
					.enter()
					.append('circle')
					.attr('class',"circle "+decile)
					.attr("fill","none")
					.attr("stroke-width", "1px")
					.attr("stroke", "#ccc")
					.attr("stroke-opacity", "0.8")
					.attr('cx',function(d,i) { return xDot(d[decile]); })
					.attr('cy',function(d,i) { return yDot(d.name); })
					.attr('r', ball);
				
				
				
			} 
		}
	)
	
	
	//annotations
	anno3_cx=[]
	anno3_cy=[]

	d3.selectAll(".circle_decile11")
			.selectAll(".decile11")
			.each( function(d,i){

				anno3_cx.push(d3.select(this).attr("cx"))
				anno3_cy.push(d3.select(this).attr("cy"))


				d3.selectAll(".circles").append("circle")
					.style("stroke", "#aaa" )
					.style("fill", "#aaa")
					.attr("class", "")
					.style("stroke-width", 2)
					.attr("stroke-opacity", 0.7/*function(){
						if(i==7){
							return "0.7"
						} else {
							return "0.2"
						}
					}*/)			
					.attr("fill-opacity", 0.7 /*function(){
						if(i==7){
							return "0.7"
						} else {
							return "0.2"
						}
					}*/)
					.attr("cx", function(d){ return  anno3_cx[i]})
					.attr("cy", function(d){ return anno3_cy[i]})
					.attr('r', ball)
			})	
	
	anno_cx=[]
	anno_cy=[]

	d3.selectAll(".circle_decile2")
			.selectAll(".decile2")
			.each( function(d,i){

				anno_cx.push(d3.select(this).attr("cx"))
				anno_cy.push(d3.select(this).attr("cy"))


				d3.selectAll(".circles").append("circle")
					.style("stroke", "#ff9933" )
					.style("fill", "#ff9933")
					.attr("class", "anno")
					.style("stroke-width", 2)
					.attr("stroke-opacity",0.7 /*function(){
						if(i==0){
							return "0.8"
						} else {
							return "0.3"
						}
					}*/)			
					.attr("fill-opacity", 0.7 /*function(){
						if(i==0){
							return "0.8"
						} else {
							return "0.3"
						}
					}*/)
					.attr("cx", function(d){ return  anno_cx[i]})
					.attr("cy", function(d){ return anno_cy[i]})
					.attr('r', ball)
			})	
	
	
	
	anno2_cx=[]
	anno2_cy=[]

	d3.selectAll(".circle_decile9")
			.selectAll(".decile9")
			.each( function(d,i){

				anno2_cx.push(d3.select(this).attr("cx"))
				anno2_cy.push(d3.select(this).attr("cy"))


				d3.selectAll(".circles").append("circle")
					.style("stroke", "#36add9" )
					.style("fill", "#36add9")
					.attr("class", "anno")
					.style("stroke-width", 2)
					.attr("stroke-opacity", 0.7/*function(){
						if(i==7){
							return "0.7"
						} else {
							return "0.2"
						}
					}*/)			
					.attr("fill-opacity", 0.7 /*function(){
						if(i==7){
							return "0.7"
						} else {
							return "0.2"
						}
					}*/)
					.attr("cx", function(d){ return  anno2_cx[i]})
					.attr("cy", function(d){ return anno2_cy[i]})
					.attr('r', ball)
			})
			
	
	
	
	if (parseInt(graphic_dots.style("width")) <= 530) { 
		d3.select("#keypoints_dots").append("p").style("color", "#FF9933")
			.text('Lower income households spend proportionally more of their expenditure on "essentials" such as food and housing, and therefore they are affected more by price changes in these categories')
		
	//	d3.select("#keypoints_dots").append("p").text("However this is offset by the fact that they spend proportionaly less in other categories.")
		
		d3.select("#keypoints_dots2").append("p").style("color", "#36add9").text('Higher income households spend proportionally less on essentials but more on "luxury" goods such as recreation and culture, and restaurants and hotels')
	} else {
		svg.append("g")
			.attr("transform", "translate("+ xDot(32) +","+  yDot("Transport") +")")
			.attr("class", "anno")
			.append("text")
			.attr("fill", "#ff9933")
			.attr("text-anchor", "middle")
			.tspans(function(d) {
				return d3.wordwrap('Lower income households spend proportionally more of their expenditure on "essentials" such as food and housing, and therefore they are affected more by price changes in these categories', 35);  
			});

	/*	svg.append("g")
			.attr("transform", "translate("+ xDot(33) +","+  (yDot("Food & non-alcoholic drinks")+15) +")")
			.attr("class", "anno")
			.append("text")
			//.attr("fill", "#ccc")
			.attr("text-anchor", "middle")
			.tspans(function(d) {
				return d3.wordwrap("However this is offset by the fact that they spend proportionaly less in other categories", 28);  
			});*/

		svg.append("g")
			.attr("transform", "translate("+ xDot(33) +","+  yDot("Furniture, household equip. & maintenance") +")")
			.attr("class", "anno")
			.append("text")
			.attr("fill", "#36add9")
			.attr("text-anchor", "middle")
			.tspans(function(d) {
				return d3.wordwrap('Higher income households spend proportionally less on essentials but more on "luxury" goods such as recreation and culture, and restaurants and hotels', 30);  
			});
	}
	
	
	// If you have labels rather than years then you can split the lines using a double space (in the CSV file).
	function insertLinebreaksLabels() {
					var str = this.textContent;

					var words = str.split('  ');

					d3.select(this/*str*/).text('');

					for (var j = 0; j < words.length; j++) {
						var tspan = d3.select(this).append('tspan').text(words[j]);
						if (j > 0)
							tspan
							.attr('x', 0)
							.attr('dy', '1em');
							}
	};

	//d3.selectAll(".labels text").each(insertLinebreaksLabels)
	
	//d3.select(".container-fluid").classed("hide", true)
} //end drawTieFighter()

		
function drawLineChart(){
	var threshold_md = 680;
	var threshold_sm = dvc.optional.mobileBreakpoint;
	
	//set variables for chart dimensions dependent on width of #graphic
	if (parseInt(graphic_line.style("width")) < threshold_sm) {
		var margin = {	top: 	dvc.optional.margin_sm[0],
						right: 	dvc.optional.margin_sm[1],
						bottom: dvc.optional.margin_sm[2],
						left: 	dvc.optional.margin_sm[3]
					};
		var size = 0;	// used for margin_centre and x_ticks
		var chart_width = parseInt(graphic_line.style("width")) - margin.left - margin.right;
		var height = Math.ceil((chart_width * dvc.optional.aspectRatio_sm[1]) / dvc.optional.aspectRatio_sm[0]) - margin.top - margin.bottom;
	} else if (parseInt(graphic_line.style("width")) < threshold_md){
		var margin = {	top: 	dvc.optional.margin_md[0],
						right: 	dvc.optional.margin_md[1],
						bottom: dvc.optional.margin_md[2],
						left: 	dvc.optional.margin_md[3]
					};
		var size = 1;
		var chart_width = parseInt(graphic_line.style("width")) - margin.left - margin.right;
		var height = Math.ceil((chart_width * dvc.optional.aspectRatio_md[1]) / dvc.optional.aspectRatio_md[0]) - margin.top - margin.bottom;
	} else {
		var margin = {	top: 	dvc.optional.margin_lg[0],
						right: 	dvc.optional.margin_lg[1],
						bottom: dvc.optional.margin_lg[2],
						left: 	dvc.optional.margin_lg[3]
					};
		var size = 2;
		var chart_width = parseInt(graphic_line.style("width")) - margin.left - margin.right;
		var height = Math.ceil((chart_width * dvc.optional.aspectRatio_lg[1]) / dvc.optional.aspectRatio_lg[0]) - margin.top - margin.bottom;
	}

	
	// clear out existing graphics
	graphic_line.selectAll("*").remove();
	keypoints_line.selectAll("*").remove();
	
	var x = d3.scaleTime()
		        .range([0, chart_width]);

	var y = d3.scaleLinear()
		.range([height, 0]);

	x.domain(d3.extent(graphic_data, function(d) { return d.date; }));

	var xAxis = d3.axisBottom(x)
		.tickFormat(function(d,i) {
			//specify date format for x axis depending on #graphic width
			if (parseInt(graphic_line.style("width")) <= threshold_sm) {
				var fmt = d3.timeFormat(dvc.optional.xAxisTextFormat_sm_md_lg[0]);
				//console.log("S "+fmt(d));
				return '\u2019' + fmt(d);
			} else if (parseInt(graphic_line.style("width")) <= threshold_md){
				var fmt = d3.timeFormat(dvc.optional.xAxisTextFormat_sm_md_lg[1]);
				//console.log("M "+fmt(d));
				return  fmt(d);
			} else {
				//console.log(dvc.optional.xAxisTextFormat_sm_md_lg[2] + ",  " + d);
				var fmt = d3.timeFormat(dvc.optional.xAxisTextFormat_sm_md_lg[2]);
				//console.log("L "+fmt(d));
				return fmt(d);
			}
		})
		.tickPadding(5)
	
	//specify number of ticks on x axis and whether 1st and last data point labels are included
	if(parseInt(graphic_line.style("width"))<threshold_sm){
		xAxis.tickValues(x.ticks(dvc.optional.x_num_ticks_sm_md_lg[0])/*.concat( x.domain() )*/);
	} else if (parseInt(graphic_line.style("width")) <= threshold_md){
		xAxis.tickValues(x.ticks(dvc.optional.x_num_ticks_sm_md_lg[1])/*.concat( x.domain() )*/);
	} else {
		xAxis.tickValues(x.ticks(dvc.optional.x_num_ticks_sm_md_lg[2])/*.concat( x.domain() )*/);
	}

	var yAxis = d3.axisLeft(y);
	
	//specify number or ticks on y axis
	if (parseInt(graphic_line.style("width")) <= threshold_sm) {
		yAxis.ticks(dvc.optional.y_num_ticks_sm_md_lg[0])
	 } else if (parseInt(graphic_line.style("width")) <= threshold_md){
		yAxis.ticks(dvc.optional.y_num_ticks_sm_md_lg[1])
	 } else {
		yAxis.ticks(dvc.optional.y_num_ticks_sm_md_lg[2])
	 }
	
	//gridlines
	var y_axis_grid = function() { return yAxis; }

	var line = d3.line()
		.x(function(d) { return x(d.date); })
		.y(function(d) { return y(d.amt); })
		.curve(d3.curveCardinal);;

	// parse data into columns
	var lines = {};
	for (var column in graphic_data[0]) {
		if (column == 'date') continue;
		lines[column] = graphic_data.map(function(d) {
			return {
				'date': d.date,
				'amt': d[column]
			};
		});
	}
	
	//y domain calculations	: zero to intelligent max choice, or intelligent min and max choice,  or interval chosen manually
	if (dvc.essential.yAxisScale == "auto_zero_max"){
	   var yDomain = [
						0,
						d3.max(d3.entries(lines), function(c) {
							return d3.max(c.value, function(v) {
								var n = v.amt;
								return Math.ceil(n);
							});
						})
					 ];
	} else if (dvc.essential.yAxisScale == "auto_min_max"){
		var yDomain = [
						d3.min(d3.entries(lines), function(c) {
							return d3.min(c.value, function(v) {
								var n = v.amt;
								return Math.floor(n);
							});
						}),

						d3.max(d3.entries(lines), function(c) {
							return d3.max(c.value, function(v) {
								var n = v.amt;
								return Math.ceil(n);
							});
						})
					];
	} else {
	   var yDomain = dvc.essential.yAxisScale;
	}

	y.domain(yDomain);
	 
	var svg = d3.select('#graphic_line').append('svg')
					.attr("id","line_chart")
					.style("background-color","#fff")
					.attr("width", chart_width + margin.left + margin.right)
					.attr("height", height + margin.top + margin.bottom )  //+30)
					.append("g")
					.attr("transform", "translate(" + margin.left + "," + margin.top + ")");


		svg.append("rect")
			.style("fill", "#fff")
			.attr("width", chart_width)
			.attr("height", height);

		svg.append('g')
			.attr('class', 'y axis')
			.call(yAxis);

		svg.append('g')
			.attr('class', 'y grid')
			.call(y_axis_grid()
				.tickSize(-chart_width, 0, 0)
				.tickFormat('')
			);
	
		//y axis label
		svg.append("text")
			//.attr('class', 'unit')
			.attr('transform','translate(' + -20 + ',-10)') // " + eval(-margin.top + (lineNo+1)*20) + "
			.attr("font-size","12px")
			.attr("fill","#666")
			.text(function(d,i) { return dvc.essential.yAxisLabel});


		//create x axis, if y axis doesn't start at 0 drop x axis accordingly
		svg.append('g')
			.attr('class', 'x axis')
			.attr('transform', 'translate(0,' +  height  + ')')
			.call(xAxis);

		d3.select(".x").select("path").style("stroke", "#666")
	
	//create lines
	svg.append('g').attr("class", "lines").selectAll('path')
		.data(d3.entries(lines))
		.enter()
		.append('path')
			.attr('class', function(d){
				 return 'line ' + d.key})
			.style("stroke", "#dadada")
			.style("opacity", 1)
			.style("fill", 'none')
			.style("stroke-width", 1)
			.style("stroke-linecap", 'round')
			.style("stroke-linejoin", 'round')
			.attr('d', function(d) {
				return line(d.value);
			});
			
	d3.select('.lines')
		.append("path")
		.attr("class", "")
		.attr("d", d3.select(".lines").select(".decile11").attr("d"))
		.attr("id","selected_line")
		.style("fill", "none")
		.style("opacity", 0.9)
		.style("stroke", "#aaa")
		.style("stroke-width", 2);
		
	d3.select('.lines')
		.append("path")
		.attr("d", d3.select(".lines").select(".decile2").attr("d"))
		.attr("class", "anno")
		.attr("id","selected_line")
		.style("fill", "none")
		.style("opacity", 1)
		.style("stroke", "#ff9933")
		.style("stroke-width", 2);
	
	d3.select('.lines')
		.append("path")
		.attr("class", "anno")
		.attr("d", d3.select(".lines").select(".decile9").attr("d"))
		.attr("id","selected_line")
		.style("fill", "none")
		.style("opacity", 1)
		.style("stroke", "#36add9")
		.style("stroke-width", 2);
		

	
	svg.append("g")
		.attr("transform", function() {
				if (parseInt(graphic_line.style("width")) <= 480) {
				   return "translate("+ x(new Date("2009-01-23")) +","+  y(6.5) +")"
			    } else if (parseInt(graphic_line.style("width")) <= 550) {
				   return "translate("+ x(new Date("2009-01-23")) +","+  y(6.2) +")"
			    } else if (parseInt(graphic_line.style("width")) <= threshold_md) {
					return "translate("+ x(new Date("2008-10-23")) +","+  y(6.0) +")"
			    } else {
					return "translate("+ x(new Date("2008-10-23")) +","+  y(6.5) +")"
			    }	  
		 })
		.attr("class", "anno")
		.append("text")
		.attr("text-anchor", "start")
		.tspans(function(d) {
			if (parseInt(graphic_line.style("width")) <= threshold_sm) {
				return d3.wordwrap("The greatest variation in inflation rates between income deciles was in January 2009.", 30);  
			} else {
				return d3.wordwrap("The greatest variation in inflation rates between income deciles was in January 2009.", 30);  
			} 
		});
		
		
	svg.append("g")
		.attr("transform", function(){
			if (parseInt(graphic_line.style("width")) <= 480) {
				return "translate("+ x(new Date("2005-07-01")) +","+  y(6.4) +")"
			} else {
				return "translate("+ x(new Date("2005-10-01")) +","+  y(6.1) +")"
			}		
		})
		.attr("class", "anno")
		.append("text")
		.attr("fill", "#9c9c9c")
		.attr("text-anchor", "start")
		.tspans(function(d) {
			return d3.wordwrap("12-month growth rate, %", 9);
		});
	
	svg.append("g")
		.attr("transform", "translate("+ x(new Date("2009-04-10")) +","+  y(1.5) +")")
		.attr("class", "anno")
		.append("text")
		.attr("fill", "#36add9")
		.attr("text-anchor", "end")
		.tspans(function(d) {
			return d3.wordwrap("Decile 9: 2.1%.", 9);  
		});
		
	
	svg.append("g")
		.attr("transform", "translate("+ x(new Date("2009-02-01")) +","+  y(4.5) +")")
		.attr("class", "anno")
		.append("text")
		.attr("fill", "#ff9933")
		.tspans(function(d) {
			return d3.wordwrap("Decile 2: 3.9%.", 9);  
		});
	
		
	svg.append("g")
		.attr("class", "anno")
		.attr("transform", function(){
			if (parseInt(graphic_line.style("width")) <= 480) {
				return "translate("+ x(new Date("2018-03-15")) +","+  y(5) +")"
			} else if(parseInt(graphic_line.style("width")) <= 825) {
				return "translate("+ x(new Date("2018-03-15")) +","+  y(5) +")"
			} else {
				return "translate("+ x(new Date("2018-03-15")) +","+  y(4.2) +")"
			}
		})
		.append("text")
		.attr("text-anchor", "end")
		.tspans(function(d) {
			return d3.wordwrap("In March 2018, inflation rates were between 2.1% (in income decile 4) and 2.4% (in income decile 9).", 23);  
		});
	
	svg.append("g")
		.attr("class", "anno")
		.attr("id", "anno_rect")
		.append("rect")
		.attr("x", x(new Date("2009-01-01")) )
		.attr("width", x(new Date("2009-01-31")) -  x(new Date("2009-01-01")) )
		.attr("y", y(5.5))
		.attr("height", y(0)-y(5.5))
		.style("fill", "grey")
		.style("opacity", 0.1)
		
svg.append("g")
		.attr("transform", "translate("+ x(new Date("2012-04-10")) +","+  y(5.5) +")")
		.attr("class", "tspans")
		.append("text")
		.attr("id", "your_decile")
		.attr("fill", "#3CB0F9")
		.attr("text-anchor", "end")
		.text("")
		
	
//	svg.append('marker')
//		.attr('id', 'arrow')
//		.attr('viewBox', '-10 -10 20 20')
//		.attr('markerWidth', 20)
//		.attr('markerHeight', 20)
//		.attr('orient', 'auto')
//		.append('path')
//		.attr("stroke", "black")
//		.attr('d', 'M-6.75,-6.75 L 0,0 L -6.75,6.75')
//
//	d3.selectAll(".annopaths")
//		.attr("stroke", "black")
//		.attr('marker-end', 'url(#arrow)');
	
	

	  
	
	// css fix
	d3.selectAll("path").attr("fill","none");

	d3.selectAll("text").attr("font-family","'Open Sans', sans-serif");

	d3.selectAll(".x text").attr("font-size","12px").attr("fill","#666");
	d3.selectAll(".y text").attr("font-size","12px").attr("fill","#666");

	d3.selectAll(".y line")
			.attr("stroke","#CCC")
			.attr("stroke-width","1px")
			.style("shape-rendering","crispEdges");

	d3.selectAll(".x line")
		.attr("stroke","#CCC")
		.attr("stroke-width","1px")
		.style("shape-rendering","crispEdges");	
	
	drawTieFighter();
	} //end drawLineChart()
	
	
	
//check to see if the web browser can handle 'inline svg'
if (Modernizr)
{

		//load config
		d3.json("./data/config_inflation_decile.json", function(error, config) {
		dvc=config

			//load chart data
			d3.csv("./data/"+dvc.essential.graphic_data_url, function(error, data) {
					graphic_data = data;

					graphic_data.forEach(function(d) {
						d.date = d3.timeParse(dvc.essential.dateFormat)(d.date);

					});

					//load config
					d3.json("./data/config_dots.json", function(error, config_dots) {
								dvc_dots=config_dots;

								//load chart data
								d3.csv("./data/"+dvc_dots.essential.graphic_data_url, function(error, data_dots) {
								graphic_data_dots = data_dots;

								//use pym to create iframed chart dependent on specified variables
								pymChild = new pym.Child({ renderCallback: drawLineChart});

								});

					})
			})

		})
	
			
		d3.select('#reveal').on("click",function(){
			d3.select("#inputs").classed("hide", false)
			d3.select(".reveal").classed("hide", true)
		}) //end refresh
	
		addremoveAdult();
			
			//Attach event listeners to + and - buttons so that we can build / remove people
			d3.select("#adultfor").select(".minus").on("click", addremoveAdult);
			d3.select("#adultfor").select(".plus").on("click", addremoveAdult);
			
			d3.select("#adults").on("change", addremoveAdult);
			
			
			d3.select("#childfor").select(".minus").on("click", addremoveAdult);
			d3.select("#childfor").select(".plus").on("click", addremoveAdult);
			
			d3.select("#child").on("change", addremoveChild);
		
		
			function addremoveAdult() {
				$("#adultPic").empty();
				$("#adultPic2").empty();
				
				 //Set maximum for child input field (has to be 1 less that number)
				$("#child").attr("max",($("#adults").val()-1));
				
				 //record value
				if($("#adults").val()>10){ 
					var numad = 10
				} else { 
					var numad = $("#adults").val()
				};
				
				for(i=0; i<numad; i++){
					d3.select("#adultPic").append("img").attr("id","person" + (numad-i)).attr("src","images/person.png").style("opacity","1").attr("height","64px").attr("width","34px");
				
					d3.select("#adultPic2").append("img").attr("id","person1" + (numad-i)).attr("src","images/person.png").style("opacity","1").attr("height","64px").attr("width","34px");
				
				}
				
				addremoveChild()
			}
			
			function addremoveChild() {
				
				if($("#child").val() <= ($("#adults").val()-1)) {
					$(".btn-number[data-type='plus'][data-field='"+name+"']").removeAttr('disabled')
				} 
				
				// record value
				if($("#child").val()>8)
					{ var numad = 8} 
				else { var numad = $("#child").val()};
				
				for(i=0; i<numad; i++){
					d3.select("#person" + (i+1)).attr("class","childPic").attr("src","images/child.png").style("opacity","1").attr("height","50px").attr("width","22px");
					d3.select("#person1" + (i+1)).attr("class","childPic").attr("src","images/child.png").style("opacity","1").attr("height","50px").attr("width","22px");
					
					
				}
			}
		
		d3.select('#submit').on("click",function(){
					//d3.select(".container-fluid").classed("hide", false)
					//d3.select("#inputs").classed("hide", true)
					//d3.select(".blurb").classed("hide", false)
					//d3.select(".decile_exp").classed("hide", false)
					d3.select("#refresh").classed("hide", false)
					
					d3.selectAll(".anno").remove();
			
					event.preventDefault();
					event.stopPropagation();
					
					// Check if the user has entered in some valid income figures
					
					regExp = RegExp(/[0-9]{1,3}/);
					
					if(regExp.test(parseFloat($("#hhincome").val().replace(/,/g, ''))) == true ) {
					
					//Get number of adults
					adults = $("#adults").val() - $("#child").val();
					 
					//Get number of children <15
					children = $("#child").val();	
					
					
					//Get Weekly / Monthly / Yearly value
					if($("#incPeriod").val() ==2) {
						dvc.respIncomePeriod=12;
					} else if($("#incPeriod").val() ==1) {
						dvc.respIncomePeriod=52;
					} else {
						dvc.respIncomePeriod=1;
					};
					
					//Get income data and annualise it...
					income = parseFloat($("#hhincome").val().replace(/,/g, '')) * dvc.respIncomePeriod;  
						
					//Work out the equivalisation factor
					//0.67+((Questions!B3+Calculations!B6-1)*0.33)+(Calculations!B7*0.2)
					equivalisation = 0.67 + ((+adults - 1)*0.33) + (children*0.2);
						
					// ZH WOrk out equivalised income
					equiv_income = income/equivalisation;
					console.log(equiv_income)	
					//Let's work out what decile this falls into
					for(i = 0; i <= 10; i++){
						if(equiv_income > deciles[i]){
							decile = i;
						}
					}
						
					d3.select("#high_low").text(function(){
							if(decile+1 <=4){
							   	return "lower"
							} else {
							   	return "higher"
							} 
					})
					d3.select("#percent_pop").text((100-(10*(decile+1)))+ "%")	
						
						
					d3.select("#percent_inflat").text(graphic_data[graphic_data.length-1]["decile"+(decile+1)]+"%")
					d3.select("#your_decile").text("Your household is in decile "+(decile+1))
					d3.select("#key2").select("label").text("Decile "+(decile+1))
					
					price_change = [36,33,33,32,32,32,31,31,31,33,32]
					
					d3.select("#price_change").text(price_change[decile]+"%")
						
					d3.select(".comparison1")
						.append("text")
						.html("Compared to ")
						
						
					d3.select('#dropdown')
						.append('select')
						.attr('class','dropdown')
						//.on('change', highlight_selected_decile)
						.selectAll("option")
						.data(graphic_data.columns)
						.enter()
						.filter(function(d){ if(d != "date"){ return d } })
						.append('option')
						.attr("value", function(d,i){return i})
						//.property("selected", function(d, i) {return i===dvc.varload;})
						.text(function(d,i){if(d=="decile11"){
												return "the average"
											} else {
												return "a "+d
											}}
							 );
						
					
					//$('.dropdown').trigger("change.select2")
					
						$('#dropdown').on('change', function () {
							//console.log('Change made to dropdown');
							highlight_selected_decile() 
						});
						
					//$('.dropdown').on("change", highlight_selected_decile() )
						
					d3.select(".comparison2")
						.append("text")
						.html("household you're experiencing <span class='decile'>xx</span> times more inflation. ")
						
					
						unhighlight_your_decile();
						highlight_your_decile();

						function unhighlight_your_decile (){
							d3.select("#highlighted_line").remove();
							d3.selectAll(".highlighted_circle").remove();
						}

						function highlight_your_decile (){
							//console.log("Highlight your decile,  decile: "+(1+decile))
						if(parseInt(d3.select("body").style("width"))>=500){
							d3.select('.lines')
								.append("path")
								.attr("d", d3.select(".lines").selectAll(".decile"+(1+decile)).attr("d"))
								.attr("id","highlighted_line")
								.style("fill", "none")
								.style("opacity", 1)
								.style("stroke", "#3CB0F9")
								.style("stroke-width", 2);
						}
						
						highlight_circles_cx=[]
						highlight_circles_cy=[]

						d3.selectAll(".circle_decile"+(1+decile))
							.selectAll(".decile"+(1+decile))
							.each( function(d,i){

								highlight_circles_cx.push(d3.select(this).attr("cx"))
								highlight_circles_cy.push(d3.select(this).attr("cy"))


								d3.selectAll(".circles").append("circle")
									.style("stroke", "#3CB0F9" )
									.style("fill", "#3CB0F9")
									.attr("class", "highlighted_circle")
									.style("stroke-width", 2)							
									.attr("opacity", "0.7")
									.attr("cx", function(d){ return highlight_circles_cx[i]})
									.attr("cy", function(d){ return highlight_circles_cy[i]})
									.attr('r', ball)
							})	
					}	
					//	console.log("select average")
						$('.dropdown').val('10').trigger('change'); // Set default of dropdown to be "the average"	
						
						
						function unhighlight_selected_decile (){
						//	console.log("remove previous selection")
							d3.select("#selected_line").remove();
							d3.selectAll(".selected_circle").remove();
						}
						
						//function to highlight selected decile e.g from dropdown
						function highlight_selected_decile(){
							unhighlight_selected_decile()
							
							var selection_decile = (parseInt($(".dropdown").val())) + 1
						//	console.log("Comparison decile selected: "+selection_decile)
							
							if(parseInt(d3.select("body").style("width"))>=500){	
								d3.select('.lines')
										.append("path")
										.attr("d", d3.select(".lines").selectAll(".decile"+selection_decile).attr("d"))
										.attr("id","selected_line")
										.style("fill", "none")
										.style("opacity", 1)
										.style("stroke", "orange")
										.style("stroke-width", 2);
							}

							selected_cx=[]
							selected_cy=[]

							d3.selectAll(".circle_decile"+selection_decile)
									.selectAll(".decile"+selection_decile)
									.each( function(d,i){

										selected_cx.push(d3.select(this).attr("cx"))
										selected_cy.push(d3.select(this).attr("cy"))


										d3.selectAll(".circles").append("circle")
											.style("stroke", "orange" )
											.style("fill", "orange")
											.attr("class", "selected_circle")
											.style("stroke-width", 2)							
											.attr("opacity", "0.7")
											.attr("cx", function(d){ return selected_cx[i]})
											.attr("cy", function(d){ return selected_cy[i]})
											.attr('r', ball)
									})	
						} //end highlighted selected decile

						
					if (pymChild) {
						pymChild.sendHeight();
					}
					
					
					} else {
					
					// Show errors
						if(regExp.test(parseFloat($("#hhincome").val().replace(/,/g, ''))) == false) {d3.select("#hhincrow").select(".input-group").classed("has-error", true)}
						
						
					}



						
				}); //end submit 
	
		d3.select('#refresh').on("click",function(){
			location.reload();
		}) //end refresh
		
//plugin bootstrap minus and plus
//http://jsfiddle.net/laelitenetwork/puJ6G/
$('.btn-number').click(function(e){
	e.preventDefault();

	fieldName = $(this).attr('data-field');
	type      = $(this).attr('data-type');
	var input = $("input[name='"+fieldName+"']");
	var currentVal = parseInt(input.val());
	if (!isNaN(currentVal)) {
		if(type == 'minus') {

			if(currentVal > input.attr('min')) {
				input.val(currentVal - 1).change();
			} 
			if(parseInt(input.val()) == input.attr('min')) {
				$(this).attr('disabled', true);
			}

		} else if(type == 'plus') {

			if(currentVal < input.attr('max')) {
				input.val(currentVal + 1).change();
			}
			if(parseInt(input.val()) == input.attr('max')) {
				$(this).attr('disabled', true);
			}

		}
	} else {
		input.val(0);
	}
});
$('.input-number').focusin(function(){
   $(this).data('oldValue', $(this).val());
});
$('.input-number').change(function() {

	minValue =  parseInt($(this).attr('min'));
	maxValue =  parseInt($(this).attr('max'));
	valueCurrent = parseInt($(this).val());

	name = $(this).attr('name');
	if(valueCurrent >= minValue) {
		$(".btn-number[data-type='minus'][data-field='"+name+"']").removeAttr('disabled')
	} else {
		//alert('Sorry, the minimum value was reached');
		$(this).val($(this).data('oldValue'));
	}
	if(valueCurrent <= maxValue) {
		$(".btn-number[data-type='plus'][data-field='"+name+"']").removeAttr('disabled')
	} else {
		//alert('Sorry, the maximum value was reached');
		$(this).val($(this).data('oldValue'));
	}


});
$(".input-number").keydown(function (e) {
		// Allow: backspace, delete, tab, escape, enter and .
		if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 190]) !== -1 ||
			 // Allow: Ctrl+A
			(e.keyCode == 65 && e.ctrlKey === true) || 
			 // Allow: home, end, left, right
			(e.keyCode >= 35 && e.keyCode <= 39)) {
				 // let it happen, don't do anything
				 return;
		}
		// Ensure that it is a number and stop the keypress
		if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
			e.preventDefault();
		}
});

function showPopUp() {
	var popup = document.getElementById("myPopup");
    popup.classList.toggle("show");
}
	
function hidePopUp() {
	
    var popup = document.getElementById("myPopup");
    popup.classList.toggle("show");
}
	
} // end if ... error
else
{
	//use pym to create iframe containing fallback image (which is set as default)
	pymChild = new pym.Child();
	if (pymChild) { pymChild.sendHeight(); }

}// end else ...
</script>
<script>
		  var _gaq = _gaq || [];
		  _gaq.push(['_setAccount', 'UA-37894017-1']);
		  _gaq.push(['_trackPageview']);
		
		
		  (function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		  })();

</script>
</body>
</html>
